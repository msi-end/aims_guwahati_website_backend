<%
  const title = 'Dashboard';
  const pageTitle = 'Dashboard';
  const pageDescription = 'Overview of admissions and gallery statistics';
%>

<!-- ===================== -->
<!-- STATS CARDS -->
<!-- ===================== -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">

  <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
    <p class="text-sm text-gray-600">Total Admissions</p>
    <h3 class="text-3xl font-bold"><%= stats.totalAdmissions %></h3>
  </div>

  <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500">
    <p class="text-sm text-gray-600">Pending</p>
    <h3 class="text-3xl font-bold"><%= stats.pendingAdmissions %></h3>
  </div>

  <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
    <p class="text-sm text-gray-600">Approved</p>
    <h3 class="text-3xl font-bold"><%= stats.approvedAdmissions %></h3>
  </div>

  <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
    <p class="text-sm text-gray-600">Gallery Images</p>
    <h3 class="text-3xl font-bold"><%= stats.totalGallery %></h3>
  </div>

</div>

<!-- ===================== -->
<!-- CHARTS -->
<!-- ===================== -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

  <!-- Admissions by Course -->
  <div class="bg-white rounded-xl shadow-lg p-6">
    <h3 class="text-lg font-bold mb-4">Admissions by Course</h3>
    <div class="h-80">
      <canvas id="courseChart"></canvas>
    </div>
  </div>

  <!-- Monthly Admissions -->
  <div class="bg-white rounded-xl shadow-lg p-6">
    <h3 class="text-lg font-bold mb-4">Monthly Admissions</h3>
    <div class="h-80">
      <canvas id="monthChart"></canvas>
    </div>
  </div>

</div>

<!-- Gallery Category -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-8">
  <h3 class="text-lg font-bold mb-4">Gallery Category Distribution</h3>
  <div class="h-64">
    <canvas id="galleryChart"></canvas>
  </div>
</div>

<!-- ===================== -->
<!-- RECENT ADMISSIONS -->
<!-- ===================== -->
<div class="bg-white rounded-xl shadow-lg overflow-hidden">
  <div class="px-6 py-4 border-b">
    <h3 class="text-lg font-bold">Recent Admissions</h3>
  </div>

  <table class="w-full">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs text-gray-500 uppercase">Student</th>
        <th class="px-6 py-3 text-left text-xs text-gray-500 uppercase">Course</th>
        <th class="px-6 py-3 text-left text-xs text-gray-500 uppercase">Phone</th>
        <th class="px-6 py-3 text-left text-xs text-gray-500 uppercase">Status</th>
        <th class="px-6 py-3 text-left text-xs text-gray-500 uppercase">Date</th>
      </tr>
    </thead>

    <tbody class="divide-y">
      <% recentAdmissions.forEach(admission => { %>
        <tr>
          <td class="px-6 py-4">
            <p class="font-medium"><%= admission.fullName %></p>
            <p class="text-sm text-gray-500"><%= admission.email %></p>
          </td>

          <td class="px-6 py-4"><%= admission.course %></td>

          <td class="px-6 py-4"><%= admission.phoneNumber %></td>

          <td class="px-6 py-4">
            <% if (admission.status === 'pending') { %>
              <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">Pending</span>
            <% } else if (admission.status === 'approved') { %>
              <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded">Approved</span>
            <% } else { %>
              <span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded">Rejected</span>
            <% } %>
          </td>

          <td class="px-6 py-4">
            <%= new Date(admission.createdAt).toLocaleDateString() %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<!-- ===================== -->
<!-- CHART JS -->
<!-- ===================== -->
<script>
  // Admissions by Course
  new Chart(document.getElementById('courseChart'), {
    type: 'pie',
    data: {
      labels: <%- JSON.stringify(admissionsByCourse.map(i => i.course)) %>,
      datasets: [{
        data: <%- JSON.stringify(admissionsByCourse.map(i => i.count)) %>,
        backgroundColor: ['#3B82F6','#10B981','#F59E0B','#EF4444','#8B5CF6']
      }]
    }
  });

  // Monthly Admissions
  new Chart(document.getElementById('monthChart'), {
    type: 'line',
    data: {
      labels: <%- JSON.stringify(admissionsByMonth.map(i => i.month)) %>,
      datasets: [{
        data: <%- JSON.stringify(admissionsByMonth.map(i => Number(i.count))) %>,
        borderColor: '#10B981',
        fill: false
      }]
    }
  });

  // Gallery Category
  new Chart(document.getElementById('galleryChart'), {
    type: 'bar',
    data: {
      labels: <%- JSON.stringify(galleryByCategory.map(i => i.category)) %>,
      datasets: [{
        data: <%- JSON.stringify(galleryByCategory.map(i => i.count)) %>,
        backgroundColor: '#8B5CF6'
      }]
    }
  });
</script>
